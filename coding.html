<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySinc - Java Code Documentation</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Java Syntax Highlighting Styles */
        .java-code {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            line-height: 1.4;
            font-size: 14px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .java-keyword { color: #569cd6; font-weight: bold; }
        .java-string { color: #ce9178; }
        .java-comment { color: #6a9955; font-style: italic; }
        .java-number { color: #b5cea8; }
        .java-class { color: #4ec9b0; font-weight: bold; }
        .java-method { color: #dcdcaa; }
        .java-annotation { color: #f44747; }
        .java-operator { color: #d4d4d4; }
        .java-bracket { color: #ffd700; }
        .java-type { color: #4ec9b0; }
        
        .toc {
            background: var(--background-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
        }
        
        .toc h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .toc li {
            margin: 8px 0;
            padding: 8px 12px;
            background: var(--background-primary);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        .toc a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .toc a:hover {
            color: var(--primary-color);
        }
        
        .code-section {
            margin: 40px 0;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .code-header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .file-upload {
            background: var(--background-secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed var(--border-color);
            text-align: center;
        }
        
        .file-upload input {
            margin: 10px;
        }
        
        .file-upload button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .file-upload button:hover {
            background: var(--primary-dark);
        }
        
        main {
            background: var(--background-primary);
            color: var(--text-primary);
        }

        .error-message {
            color: #f44747;
            background: rgba(244, 71, 71, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f44747;
        }

        .success-message {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>StudySinc</h1>
            <p class="subtitle">Daniel French</p>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="specification.html">Specification</a></li>
                    <li><a href="design.html">Design</a></li>
                    <li><a href="coding.html">Development</a></li>
                    <li><a href="technical.html">Testing</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <h1>Java Code Documentation</h1>
            
            <div class="file-upload">
                <h3>Java Documentation</h3>
                <p>Loading Java files from repository...</p>
                <div id="loadingStatus">Fetching files...</div>
            </div>
            
            <div id="tableOfContents" class="toc" style="display: none;">
                <h3>Table of Contents</h3>
                <ul id="tocList"></ul>
            </div>
            
            <div id="codeContent"></div>
        </main>

        <footer>
            <p>&copy; 2025 Daniel French</p>
        </footer>
    </div>

    <script>
        class JavaSyntaxHighlighter {
            constructor() {
                this.keywords = [
                    'abstract', 'assert', 'boolean', 'break', 'byte', 'case', 'catch', 'char',
                    'class', 'const', 'continue', 'default', 'do', 'double', 'else', 'enum',
                    'extends', 'final', 'finally', 'float', 'for', 'goto', 'if', 'implements',
                    'import', 'instanceof', 'int', 'interface', 'long', 'native', 'new',
                    'package', 'private', 'protected', 'public', 'return', 'short', 'static',
                    'strictfp', 'super', 'switch', 'synchronized', 'this', 'throw', 'throws',
                    'transient', 'try', 'void', 'volatile', 'while', 'true', 'false', 'null'
                ];
                
                this.types = [
                    'String', 'Integer', 'Double', 'Float', 'Boolean', 'Character', 'Byte',
                    'Short', 'Long', 'Object', 'Array', 'List', 'ArrayList', 'HashMap',
                    'HashSet', 'TreeMap', 'TreeSet', 'LinkedList', 'Vector', 'Stack',
                    'Connection', 'PreparedStatement', 'ResultSet', 'SQLException',
                    'JPanel', 'JButton', 'JLabel', 'JTextField', 'JTextArea', 'JScrollPane',
                    'BorderLayout', 'FlowLayout', 'BoxLayout', 'GridLayout', 'Color',
                    'Font', 'Dimension', 'MouseEvent', 'ActionEvent', 'MouseAdapter',
                    'SwingUtilities', 'JOptionPane', 'JDialog', 'Frame', 'Border',
                    'BorderFactory', 'Cursor', 'Box', 'Timestamp', 'Notification'
                ];
            }
            
            highlight(code) {
                // Escape HTML first
                code = code.replace(/&/g, '&amp;')
                          .replace(/</g, '&lt;')
                          .replace(/>/g, '&gt;');
                
                // Use a more systematic approach with placeholders to avoid conflicts
                const tokens = [];
                let tokenIndex = 0;
                
                // Helper function to create unique token
                const createToken = (content, className) => {
                    const token = `__TOKEN_${tokenIndex}__`;
                    tokens[tokenIndex] = `<span class="${className}">${content}</span>`;
                    tokenIndex++;
                    return token;
                };
                
                // 1. Multi-line comments first (highest priority)
                code = code.replace(/\/\*[\s\S]*?\*\//g, (match) => {
                    return createToken(match, 'java-comment');
                });
                
                // 2. Single-line comments
                code = code.replace(/\/\/.*$/gm, (match) => {
                    return createToken(match, 'java-comment');
                });
                
                // 3. Strings (both double and single quotes)
                code = code.replace(/"([^"\\]|\\.)*"/g, (match) => {
                    return createToken(match, 'java-string');
                });
                code = code.replace(/'([^'\\]|\\.)*'/g, (match) => {
                    return createToken(match, 'java-string');
                });
                
                // 4. Numbers
                code = code.replace(/\b\d+(\.\d+)?[fFdDlL]?\b/g, (match) => {
                    return createToken(match, 'java-number');
                });
                
                // 5. Annotations
                code = code.replace(/@\w+/g, (match) => {
                    return createToken(match, 'java-annotation');
                });
                
                // 6. Keywords (be careful not to match within words)
                this.keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                    code = code.replace(regex, (match) => {
                        return createToken(match, 'java-keyword');
                    });
                });
                
                // 7. Types
                this.types.forEach(type => {
                    const regex = new RegExp(`\\b${type}\\b`, 'g');
                    code = code.replace(regex, (match) => {
                        return createToken(match, 'java-type');
                    });
                });
                
                // 8. Method calls (word followed by opening parenthesis)
                code = code.replace(/\b([a-zA-Z_]\w*)\s*(?=\()/g, (match, methodName) => {
                    // Don't highlight if it's already a keyword or type
                    if (this.keywords.includes(methodName) || this.types.includes(methodName)) {
                        return match;
                    }
                    return createToken(methodName, 'java-method') + match.substring(methodName.length);
                });
                
                // 9. Brackets and operators
                code = code.replace(/[{}[\]()]/g, (match) => {
                    return createToken(match, 'java-bracket');
                });
                code = code.replace(/[+\-*/%=<>!&|^~?:;,.]/g, (match) => {
                    return createToken(match, 'java-operator');
                });
                
                // Replace all tokens with their corresponding spans
                for (let i = 0; i < tokenIndex; i++) {
                    code = code.replace(`__TOKEN_${i}__`, tokens[i]);
                }
                
                return code;
            }
        }
        
        const highlighter = new JavaSyntaxHighlighter();
        let loadedFiles = [];
        
        // Configuration
        const REPO_CONFIG = {
            owner: 'TMFrench',
            repo: 'IT_PAT',
            javaFilesPath: 'info',
            branch: 'feature/create-website'
            // Note: GitHub token removed for security - public repos don't need authentication
        };
        
        // GitHub API base URL
        const GITHUB_API_BASE = `https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}`;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadJavaFilesFromRepo();
        });
        
        async function loadJavaFilesFromRepo() {
            const statusDiv = document.getElementById('loadingStatus');
            
            try {
                statusDiv.innerHTML = 'Fetching file list from repository...';
                
                // Create headers for the request
                const headers = {
                    'Accept': 'application/vnd.github.v3+json',
                    'User-Agent': 'StudySinc-Documentation'
                };
                
                // Get list of files in the Java files directory
                const url = `${GITHUB_API_BASE}/contents/${REPO_CONFIG.javaFilesPath}?ref=${REPO_CONFIG.branch}`;
                console.log('Fetching from URL:', url);
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Response:', response.status, errorText);
                    throw new Error(`Failed to fetch repository contents: ${response.status} ${response.statusText}`);
                }
                
                const files = await response.json();
                console.log('Files found:', files);
                
                // Filter for Java files
                const javaFiles = files.filter(file => 
                    file.name.endsWith('.java') && 
                    file.type === 'file'
                );
                
                if (javaFiles.length === 0) {
                    statusDiv.innerHTML = `<div class="error-message">No Java files found in /${REPO_CONFIG.javaFilesPath}/</div>`;
                    return;
                }
                
                statusDiv.innerHTML = `Found ${javaFiles.length} Java files. Loading content...`;
                
                // Load content of each Java file
                loadedFiles = [];
                for (const file of javaFiles) {
                    await loadFileContent(file);
                }
                
                if (loadedFiles.length === 0) {
                    statusDiv.innerHTML = `<div class="error-message">Failed to load any Java files</div>`;
                    return;
                }
                
                statusDiv.innerHTML = `<div class="success-message">✓ Successfully loaded ${loadedFiles.length} Java files</div>`;
                
                // Display the files
                displayFiles();
                
            } catch (error) {
                console.error('Error loading Java files:', error);
                statusDiv.innerHTML = `<div class="error-message">
                    <strong>Error loading files:</strong> ${error.message}<br>
                    <small>Please check the repository configuration and ensure the files exist.</small><br>
                    <small>Repository: ${REPO_CONFIG.owner}/${REPO_CONFIG.repo}</small><br>
                    <small>Path: ${REPO_CONFIG.javaFilesPath}</small><br>
                    <small>Branch: ${REPO_CONFIG.branch}</small>
                </div>`;
            }
        }
        
        async function loadFileContent(fileInfo) {
            try {
                console.log('Loading file:', fileInfo.name, 'from:', fileInfo.download_url);
                
                // Fetch raw file content
                const response = await fetch(fileInfo.download_url);
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch ${fileInfo.name}: ${response.status}`);
                }
                
                const content = await response.text();
                const className = extractClassName(content, fileInfo.name);
                
                loadedFiles.push({
                    name: fileInfo.name,
                    className: className,
                    content: content,
                    path: fileInfo.path,
                    size: fileInfo.size
                });
                
                console.log('Successfully loaded:', fileInfo.name);
                
            } catch (error) {
                console.error(`Error loading ${fileInfo.name}:`, error);
                // Continue with other files even if one fails
            }
        }
        
        function extractClassName(content, fileName) {
            // Try to extract class name from the code
            const classMatch = content.match(/(?:public\s+)?(?:abstract\s+)?(?:final\s+)?class\s+(\w+)/);
            if (classMatch) {
                return classMatch[1];
            }
            
            // Try interface
            const interfaceMatch = content.match(/(?:public\s+)?interface\s+(\w+)/);
            if (interfaceMatch) {
                return interfaceMatch[1];
            }
            
            // Try enum
            const enumMatch = content.match(/(?:public\s+)?enum\s+(\w+)/);
            if (enumMatch) {
                return enumMatch[1];
            }
            
            // Fallback to filename without extension
            return fileName.replace('.java', '');
        }
        
        function displayFiles() {
            if (loadedFiles.length === 0) {
                return;
            }
            
            // Sort files alphabetically by class name
            loadedFiles.sort((a, b) => a.className.localeCompare(b.className));
            
            // Get DOM elements
            const tocList = document.getElementById('tocList');
            const toc = document.getElementById('tableOfContents');
            const codeContent = document.getElementById('codeContent');
            
            // Clear existing content
            tocList.innerHTML = '';
            codeContent.innerHTML = '';
            
            // Generate table of contents and code sections
            loadedFiles.forEach((file, index) => {
                // Add to table of contents
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${file.className}`;
                a.textContent = `${file.className} (${file.name})`;
                li.appendChild(a);
                tocList.appendChild(li);
                
                // Add code section
                const section = document.createElement('div');
                section.className = 'code-section';
                section.id = file.className;
                
                const header = document.createElement('div');
                header.className = 'code-header';
                header.textContent = `${file.className} - ${file.name}`;
                
                const codeBlock = document.createElement('div');
                codeBlock.className = 'java-code';
                
                // Apply syntax highlighting
                const highlightedCode = highlighter.highlight(file.content);
                codeBlock.innerHTML = `<pre>${highlightedCode}</pre>`;
                
                section.appendChild(header);
                section.appendChild(codeBlock);
                codeContent.appendChild(section);
            });
            
            // Show table of contents
            toc.style.display = 'block';
            
            // Add smooth scrolling for TOC links
            document.querySelectorAll('#tocList a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const target = document.querySelector(targetId);
                    if (target) {
                        target.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start',
                            inline: 'nearest'
                        });
                    }
                });
            });
            
            console.log('Successfully displayed', loadedFiles.length, 'files');
        }
    </script>
</body>
</html>
